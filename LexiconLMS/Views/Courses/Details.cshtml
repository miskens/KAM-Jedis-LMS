@using System.Data.Entity
@using LexiconLMS.Models
@model LexiconLMS.Models.Course

@{
    ViewBag.Title = "KursDetaljer";

    var context = new ApplicationDbContext();

    var activities = context.Activities.Where(a => a.CourseId == Model.Id);
    
    string sender = Request.RequestContext.RouteData.Values["sender"].ToString();
    int groupId = 0;
    if (Request.RequestContext.RouteData.Values["gId"] != null)
    { 
        groupId = Int32.Parse(Request.RequestContext.RouteData.Values["gId"].ToString());
    }
}
<h2>@Model.Name</h2>

<div>
    @*   <h4>Course</h4>*@
    <hr/>
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Description)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Description)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.StartDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.StartDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EndDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EndDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.GroupId)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.GroupId)
        </dd>

    </dl>
</div>
<div>
    @Html.Partial("_CourseActivities", activities)
</div>
<p>
    @if (User.IsInRole("lärare"))
    {
        @Html.ActionLink("Ändra", "Edit", new {id = Model.Id})
    }
    @if (sender == "g")
    {
        if (User.IsInRole("lärare"))
        {
            if (groupId != 0)
            {
                @Html.ActionLink("Tillbaka", "Details", "Group", new { id = groupId}, null)
            }
            else
            {
                @Html.ActionLink("Tillbaka", "Details", "Group")
            }
        }
        if (User.IsInRole("elev"))
        {
            @Html.ActionLink("Tillbaka", "Index", "Group")
        }
    }
    else
    {
        @Html.ActionLink("Tillbaka till listan", "Index")
    }
</p>
